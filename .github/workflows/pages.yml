name: Deploy to GitHub Pages

on:
  push:
      branches: [main]
        workflow_dispatch:

        permissions:
          contents: read
            pages: write
              id-token: write

              jobs:
                build:
                    runs-on: ubuntu-latest
                        steps:
                              - uses: actions/checkout@v4

                                          - name: Setup Node.js
                                                  uses: actions/setup-node@v4
                                                          with:
                                                                    node-version: '20'

                                                                                - name: Setup Python
                                                                                        uses: actions/setup-python@v5
                                                                                                with:
                                                                                                          python-version: '3.11'
                                                                                                                
                                                                                                                      - name: Build MkDocs
                                                                                                                              run: |
                                                                                                                                        cd docs
                                                                                                                                                  pip install -r requirements.txt
                                                                                                                                                            mkdocs build -d ../public/docs
                                                                                                                                                                  
                                                                                                                                                                        - name: Build Next.js
                                                                                                                                                                                run: |
                                                                                                                                                                                          cd web
                                                                                                                                                                                                    npm ci
                                                                                                                                                                                                              npm run build
                                                                                                                                                                                                                        mv out ../public/web
                                                                                                                                                                                                                              
                                                                                                                                                                                                                                    - name: Upload artifact
                                                                                                                                                                                                                                            uses: actions/upload-pages-artifact@v3
                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                              path: ./public
                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                deploy:
                                                                                                                                                                                                                                                                    needs: build
                                                                                                                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                            environment:
                                                                                                                                                                                                                                                                                  name: github-pages
                                                                                                                                                                                                                                                                                        url: ${{ steps.deployment.outputs.page_url }}
                                                                                                                                                                                                                                                                                            steps:
                                                                                                                                                                                                                                                                                                  - name: Deploy to GitHub Pages
                                                                                                                                                                                                                                                                                                          id: deployment
                                                                                                                                                                                                                                                                                                                  uses: actions/deploy-pages@v4
                                                                                                                                                                                                                                                                                                                  
